<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

<!-- 게시판 글 작성  -->
<insert id="insert">
insert into mp_board(bno,title,content,writer)
values(mp_board_seq.nextval,#{title},#{content},#{writer})
</insert>

<!-- 게시판 목록 출력  -->
<select id="listPage" resultType="kr.co.vo.BoardVO"
parameterType="kr.co.vo.Criteria">
select bno,title,writer,regdate 
from (select bno,title,content,writer,regdate,
row_number() over(order by bno desc) as rnum
from mp_board
where 1=1
<include refid="search"></include>
) mp
where rnum between #{rowStart} and #{rowEnd}
order by bno desc
</select>

<select id="listCount" resultType="int" parameterType="kr.co.vo.SearchCriteria">
SELECT COUNT(BNO)
FROM MP_BOARD
WHERE 1=1
<include refid="search"></include>
AND BNO > 0
</select>

<sql id="search">
<if test="searchType != null">
<if test="searchType == 't'.toString()">AND TITLE LIKE
'%' || #{keyword} || '%'</if>
<if test="searchType == 'c'.toString()">AND CONTENT LIKE
'%' || #{keyword} || '%'</if>
<if test="searchType == 'w'.toString()">AND WRITER LIKE
'%' || #{keyword} || '%'</if>
<if test="searchType == 'tc'.toString()">AND (TITLE LIKE
'%' || #{keyword} || '%') or (CONTENT LIKE '%' || #{keyword} || '%')</if>
</if>
</sql>

<select id="read" parameterType="int" resultType="kr.co.vo.BoardVO">
select bno,title,content,writer,regdate
from mp_board where bno=#{bno}
</select>

<update id="update" parameterType="kr.co.vo.BoardVO">
update mp_board 
set 
title=#{title}, content=#{content} where bno=#{bno}
</update>

<delete id="delete" parameterType="int">
delete from mp_board where bno=#{bno}
</delete>
</mapper>
